<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>WebSocket æ¸¬è©¦</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
      max-width: 600px;
      margin: auto;
    }

    #log {
      white-space: pre-wrap;
      border: 1px solid #ccc;
      padding: 1em;
      height: 250px;
      overflow-y: scroll;
      background-color: #f8f8f8;
    }

    input,
    button {
      padding: 0.5em;
      margin-top: 1em;
      font-size: 14px;
    }

    button:disabled {
      opacity: 0.5;
    }

    .status {
      margin-top: 1em;
      font-weight: bold;
    }

    .status.connected {
      color: green;
    }

    .status.error {
      color: red;
    }

    .status.closed {
      color: gray;
    }
  </style>
</head>

<body>
  <h2>ğŸ§ª WebSocket æ¸¬è©¦å·¥å…·</h2>

  <div>
    <label>WebSocket URLï¼š</label>
    <input type="text" id="ws-url" value="ws://127.0.0.1:5002/ws" size="40">
    <button onclick="connect()" id="btn-connect">é€£ç·š</button>
    <button onclick="disconnect()" id="btn-disconnect" disabled>æ–·é–‹</button>
  </div>

  <div id="status" class="status closed">ğŸ”Œ å°šæœªé€£ç·š</div>

  <div style="margin-top: 1em;">
    <input type="text" id="message" placeholder="è¼¸å…¥è¨Šæ¯" />
    <button onclick="sendMessage()">é€å‡ºè¨Šæ¯</button>
  </div>

  <h3>ğŸ“œ Logï¼š</h3>
  <div id="log"></div>

  <script>
    let socket;

    const logEl = document.getElementById("log");
    const statusEl = document.getElementById("status");
    const connectBtn = document.getElementById("btn-connect");
    const disconnectBtn = document.getElementById("btn-disconnect");

    function log(message, type = 'info') {
      const now = new Date().toLocaleTimeString();
      logEl.textContent += `[${now}] ${message}\n`;
      logEl.scrollTop = logEl.scrollHeight;
    }

    function updateStatus(text, state) {
      statusEl.textContent = text;
      statusEl.className = 'status ' + state;
    }

    function connect() {
      const url = document.getElementById("ws-url").value;
      socket = new WebSocket(url);

      socket.onopen = () => {
        updateStatus("âœ… å·²é€£ç·šåˆ° " + url, 'connected');
        log("é€£ç·šæˆåŠŸ", 'success');
        connectBtn.disabled = true;
        disconnectBtn.disabled = false;
      };

      socket.onmessage = (event) => {
        log("ğŸ“¥ æ”¶åˆ°è¨Šæ¯ï¼š" + event.data, 'info');
      };

      socket.onerror = (error) => {
        log("âŒ éŒ¯èª¤ç™¼ç”Ÿï¼š" + error.message, 'error');
        updateStatus("âŒ ç™¼ç”ŸéŒ¯èª¤", 'error');
      };

      socket.onclose = (event) => {
        log(`ğŸ”Œ é€£ç·šå·²é—œé–‰ (Code: ${event.code})`, 'info');
        updateStatus("ğŸ”Œ é€£ç·šå·²é—œé–‰", 'closed');
        connectBtn.disabled = false;
        disconnectBtn.disabled = true;
      };
    }

    function disconnect() {
      if (socket) {
        socket.close();
      }
    }

    function sendMessage() {
      const msgEl = document.getElementById("message");
      const msg = msgEl.value.trim();
      if (!msg) {
        log("âš ï¸ è«‹è¼¸å…¥è¨Šæ¯å…§å®¹", 'warning');
        return;
      }

      if (socket && socket.readyState === WebSocket.OPEN) {
        socket.send(msg);
        log("ğŸ“¤ å·²é€å‡ºè¨Šæ¯ï¼š" + msg, 'info');
        msgEl.value = ""; // é€å‡ºå¾Œæ¸…ç©º
      } else {
        log("âš ï¸ WebSocket å°šæœªé€£ç·š", 'warning');
      }
    }
  </script>
</body>

</html>
